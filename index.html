<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>JC — Bible Search Map</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
body {
  background: #0b0b0b;
  color: #eee;
  font-family: Arial, sans-serif;
  margin: 0;
  padding: 20px;
}

input, button {
  width: 100%;
  padding: 10px;
  font-size: 16px;
  margin-bottom: 10px;
}

button {
  background: #d4af37;
  border: none;
  font-weight: bold;
  cursor: pointer;
}

svg {
  width: 100%;
  height: 520px;
  background: #050505;
  border: 1px solid #333;
}

.node {
  fill: #d4af37;
  cursor: pointer;
}

.link {
  fill: none;
  stroke: rgba(212,175,55,0.25);
  stroke-width: 1.5;
}

#popup {
  position: fixed;
  left: 10px;
  right: 10px;
  bottom: 10px;
  background: #111;
  padding: 10px;
  border-left: 4px solid #d4af37;
  display: none;
}
</style>
</head>
<body>

<h1>JC — Bible Search Visualization</h1>

<input id="query" placeholder="Keyword or reference (Jesus, faith, John 3:16)">
<button onclick="runSearch()">Search & Visualize</button>

<svg id="map"></svg>
<div id="popup"></div>

<script>
const API_KEY = "PUT_YOUR_API_KEY_HERE";
const BIBLE_ID = "de4e12af7f28f599-01";
const BASE = "https://api.scripture.api.bible/v1";

const bookIndex = {};
[
"Genesis","Exodus","Leviticus","Numbers","Deuteronomy","Joshua","Judges","Ruth",
"1 Samuel","2 Samuel","1 Kings","2 Kings","1 Chronicles","2 Chronicles","Ezra",
"Nehemiah","Esther","Job","Psalms","Proverbs","Ecclesiastes","Song of Solomon",
"Isaiah","Jeremiah","Lamentations","Ezekiel","Daniel","Hosea","Joel","Amos",
"Obadiah","Jonah","Micah","Nahum","Habakkuk","Zephaniah","Haggai","Zechariah",
"Malachi","Matthew","Mark","Luke","John","Acts","Romans","1 Corinthians",
"2 Corinthians","Galatians","Ephesians","Philippians","Colossians",
"1 Thessalonians","2 Thessalonians","1 Timothy","2 Timothy","Titus","Philemon",
"Hebrews","James","1 Peter","2 Peter","1 John","2 John","3 John","Jude","Revelation"
].forEach((b,i)=>bookIndex[b]=i);

async function api(path) {
  return fetch(BASE + path, {
    headers: { "api-key": API_KEY }
  }).then(r=>r.json());
}

async function runSearch() {
  const q = document.getElementById("query").value.trim();
  if (!q) return;

  const svg = document.getElementById("map");
  svg.innerHTML = "";
  document.getElementById("popup").style.display = "none";

  // 1️⃣ SEARCH
  const search = await api(`/bibles/${BIBLE_ID}/search?query=${encodeURIComponent(q)}&limit=200`);
  const results = search.data.verses;
  if (!results.length) {
    alert("No results found.");
    return;
  }

  // 2️⃣ LOAD VERSE TEXTS
  const verses = [];
  for (const v of results) {
    const verse = await api(`/bibles/${BIBLE_ID}/verses/${v.id}`);
    verses.push({
      book: verse.data.reference.split(" ")[0],
      chapter: parseInt(verse.data.reference.split(" ")[1]),
      ref: verse.data.reference,
      text: verse.data.content.replace(/<[^>]+>/g,"")
    });
  }

  const w = svg.clientWidth;
  const h = svg.clientHeight;

  const points = verses.map(v => ({
    x: (bookIndex[v.book] / 66) * (w - 40) + 20,
    y: (v.chapter / 150) * (h - 40) + 20,
    data: v
  }));

  // 3️⃣ DRAW ARCH CONNECTIONS
  for (let i = 0; i < points.length - 1; i++) {
    const a = points[i];
    const b = points[i+1];
    const mid = (a.x + b.x) / 2;

    const path = document.createElementNS("http://www.w3.org/2000/svg","path");
    path.setAttribute("d", `M${a.x},${a.y} Q${mid},${a.y-80} ${b.x},${b.y}`);
    path.setAttribute("class","link");
    svg.appendChild(path);
  }

  // 4️⃣ DRAW POINTS
  points.forEach(p => {
    const c = document.createElementNS("http://www.w3.org/2000/svg","circle");
    c.setAttribute("cx", p.x);
    c.setAttribute("cy", p.y);
    c.setAttribute("r", 4);
    c.setAttribute("class","node");
    c.onclick = () => {
      const pop = document.getElementById("popup");
      pop.innerHTML = `<strong>${p.data.ref}</strong><br>${p.data.text}`;
      pop.style.display = "block";
    };
    svg.appendChild(c);
  });
}
</script>

</body>
</html>
