<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>JC — Bible Connections Map</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
body {
  background: #0a0a0a;
  color: #eee;
  font-family: Arial, sans-serif;
  margin: 0;
  padding: 20px;
}

input, button {
  padding: 10px;
  font-size: 16px;
  width: 100%;
  margin-bottom: 10px;
}

button {
  background: #d4af37;
  border: none;
  cursor: pointer;
  font-weight: bold;
}

#map {
  border: 1px solid #333;
  margin-top: 20px;
  background: #050505;
}

.node {
  fill: #d4af37;
  cursor: pointer;
}

.link {
  fill: none;
  stroke: rgba(212,175,55,0.25);
  stroke-width: 1.5;
}

#popup {
  position: fixed;
  bottom: 10px;
  left: 10px;
  right: 10px;
  background: #111;
  padding: 10px;
  border-left: 4px solid #d4af37;
  display: none;
}
</style>
</head>
<body>

<h1>JC — Bible Interconnection Map</h1>
<p>Visualize how Scripture connects through repeated words</p>

<input id="keyword" placeholder="Enter keyword (Jesus, faith, light)">
<button onclick="loadData()">Generate Map</button>

<svg id="map" width="100%" height="500"></svg>

<div id="popup"></div>

<script>
const bookIndex = {};
const bookOrder = [
  "Genesis","Exodus","Leviticus","Numbers","Deuteronomy","Joshua","Judges","Ruth",
  "1 Samuel","2 Samuel","1 Kings","2 Kings","1 Chronicles","2 Chronicles","Ezra",
  "Nehemiah","Esther","Job","Psalms","Proverbs","Ecclesiastes","Song of Solomon",
  "Isaiah","Jeremiah","Lamentations","Ezekiel","Daniel","Hosea","Joel","Amos",
  "Obadiah","Jonah","Micah","Nahum","Habakkuk","Zephaniah","Haggai","Zechariah",
  "Malachi","Matthew","Mark","Luke","John","Acts","Romans","1 Corinthians",
  "2 Corinthians","Galatians","Ephesians","Philippians","Colossians",
  "1 Thessalonians","2 Thessalonians","1 Timothy","2 Timothy","Titus","Philemon",
  "Hebrews","James","1 Peter","2 Peter","1 John","2 John","3 John","Jude","Revelation"
];

bookOrder.forEach((b,i)=>bookIndex[b]=i);

async function loadData() {
  const keyword = document.getElementById("keyword").value.trim();
  if (!keyword) return;

  const svg = document.getElementById("map");
  svg.innerHTML = "";

  const res = await fetch(
    `https://labs.bible.org/api/?passage=${encodeURIComponent(keyword)}&type=json`
  );
  const verses = await res.json();

  if (!verses.length) {
    alert("No results found.");
    return;
  }

  const width = svg.clientWidth;
  const height = svg.clientHeight;

  const points = verses.map(v => {
    return {
      x: (bookIndex[v.bookname] / bookOrder.length) * width + 30,
      y: (v.chapter / 150) * height + 20,
      text: `${v.bookname} ${v.chapter}:${v.verse} — ${v.text}`
    };
  });

  // Draw arches
  for (let i = 0; i < points.length - 1; i++) {
    const a = points[i];
    const b = points[i+1];
    const path = document.createElementNS("http://www.w3.org/2000/svg","path");
    const midX = (a.x + b.x) / 2;
    const d = `M ${a.x},${a.y} Q ${midX},${a.y-80} ${b.x},${b.y}`;
    path.setAttribute("d", d);
    path.setAttribute("class","link");
    svg.appendChild(path);
  }

  // Draw nodes
  points.forEach(p => {
    const c = document.createElementNS("http://www.w3.org/2000/svg","circle");
    c.setAttribute("cx", p.x);
    c.setAttribute("cy", p.y);
    c.setAttribute("r", 4);
    c.setAttribute("class","node");

    c.onclick = () => {
      const popup = document.getElementById("popup");
      popup.textContent = p.text;
      popup.style.display = "block";
    };

    svg.appendChild(c);
  });
}
</script>

</body>
</html>
